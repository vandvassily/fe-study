<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/favicon.ico"><title>响应式原理 | fe-study</title><meta name="description" content="前端知识笔记">
    <link rel="modulepreload" href="/fe-study/assets/app.9bc35547.js"><link rel="modulepreload" href="/fe-study/assets/响应式原理.html.959b348c.js"><link rel="modulepreload" href="/fe-study/assets/plugin-vue_export-helper.5a098b48.js"><link rel="modulepreload" href="/fe-study/assets/响应式原理.html.97d2f5ac.js">
    <link rel="stylesheet" href="/fe-study/assets/style.2c625487.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/fe-study/" class=""><!----><span class="site-name can-hide">fe-study</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/fe-study/" class="nav-link" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="http://vandvassily.cn/" rel="noopener noreferrer" target="_blank" aria-label="Blog"><!--[--><!--]--> Blog <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/vandvassily/fe-study" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/fe-study/" class="nav-link" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="http://vandvassily.cn/" rel="noopener noreferrer" target="_blank" aria-label="Blog"><!--[--><!--]--> Blog <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/vandvassily/fe-study" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><a href="/fe-study/javascript/" class="nav-link sidebar-heading sidebar-item" aria-label="JS知识"><!--[--><!--]--> JS知识 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/javascript/basic/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html" class="nav-link sidebar-item" aria-label="数据类型"><!--[--><!--]--> 数据类型 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/%E5%8E%9F%E5%9E%8B.html" class="nav-link sidebar-item" aria-label="原型、原型链、继承"><!--[--><!--]--> 原型、原型链、继承 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/%E8%AF%8D%E6%B3%95%E4%BD%9C%E7%94%A8%E5%9F%9F.html" class="nav-link sidebar-item" aria-label="词法作用域"><!--[--><!--]--> 词法作用域 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87.html" class="nav-link sidebar-item" aria-label="执行上下文"><!--[--><!--]--> 执行上下文 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E6%A0%88.html" class="nav-link sidebar-item" aria-label="JavaScript深入之执行上下文栈"><!--[--><!--]--> JavaScript深入之执行上下文栈 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE.html" class="nav-link sidebar-item" aria-label="作用域链"><!--[--><!--]--> 作用域链 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/this.html" class="nav-link sidebar-item" aria-label="this"><!--[--><!--]--> this <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/new.html" class="nav-link sidebar-item" aria-label="new 的原理"><!--[--><!--]--> new 的原理 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/call%20apply%20bind.html" class="nav-link sidebar-item" aria-label="call apply bind"><!--[--><!--]--> call apply bind <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/EventLoop.html" class="nav-link sidebar-item" aria-label="EventLoop 事件循环"><!--[--><!--]--> EventLoop 事件循环 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/array.html" class="nav-link sidebar-item" aria-label="数组方法"><!--[--><!--]--> 数组方法 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/currying.html" class="nav-link sidebar-item" aria-label="函数柯里化"><!--[--><!--]--> 函数柯里化 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/%E6%B7%B1%E6%8B%B7%E8%B4%9D.html" class="nav-link sidebar-item" aria-label="深拷贝"><!--[--><!--]--> 深拷贝 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/usage/debounce-throttle.html" class="nav-link sidebar-item" aria-label="防抖 与 节流"><!--[--><!--]--> 防抖 与 节流 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/browser/" class="nav-link sidebar-heading sidebar-item" aria-label="浏览器"><!--[--><!--]--> 浏览器 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/browser/%E8%BE%93%E5%85%A5URL.html" class="nav-link sidebar-item" aria-label="输入URL后，发生了什么"><!--[--><!--]--> 输入URL后，发生了什么 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/vue/" class="nav-link router-link-active sidebar-heading sidebar-item active" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/vue/lifeCircle.html" class="nav-link sidebar-item" aria-label="Vue生命周期"><!--[--><!--]--> Vue生命周期 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/fe-study/vue/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="响应式原理"><!--[--><!--]--> 响应式原理 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/fe-study/vue/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#观察者模式-发布-订阅模式" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="观察者模式/发布-订阅模式"><!--[--><!--]--> 观察者模式/发布-订阅模式 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/fe-study/vue/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#vue的实现思路" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Vue的实现思路"><!--[--><!--]--> Vue的实现思路 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/fe-study/vue/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#源码" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="源码"><!--[--><!--]--> 源码 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/fe-study/vue/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#简写实现" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="简写实现"><!--[--><!--]--> 简写实现 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/fe-study/vue/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#检测变化的注意事项" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="检测变化的注意事项"><!--[--><!--]--> 检测变化的注意事项 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/fe-study/vue/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#对于对象" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="对于对象"><!--[--><!--]--> 对于对象 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/fe-study/vue/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#对于数组" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="对于数组"><!--[--><!--]--> 对于数组 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/fe-study/vue/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#附赠面试真题" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="附赠面试真题"><!--[--><!--]--> 附赠面试真题 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/fe-study/vue/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#参考资料" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="参考资料"><!--[--><!--]--> 参考资料 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/fe-study/vue/nextTick.html" class="nav-link sidebar-item" aria-label="异步更新队列"><!--[--><!--]--> 异步更新队列 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/vue/watcher.html" class="nav-link sidebar-item" aria-label="computed 和 watch 的原理"><!--[--><!--]--> computed 和 watch 的原理 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/vue/diff.html" class="nav-link sidebar-item" aria-label="Diff算法"><!--[--><!--]--> Diff算法 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/vue/keep-alive.html" class="nav-link sidebar-item" aria-label="keep-alive 组件"><!--[--><!--]--> keep-alive 组件 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/vue/Vue3.html" class="nav-link sidebar-item" aria-label="Vue3"><!--[--><!--]--> Vue3 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/react/" class="nav-link sidebar-heading sidebar-item" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/react/React%E6%9E%B6%E6%9E%84.html" class="nav-link sidebar-item" aria-label="React 架构"><!--[--><!--]--> React 架构 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/jsx.html" class="nav-link sidebar-item" aria-label="JSX是什么？"><!--[--><!--]--> JSX是什么？ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/lifecircle.html" class="nav-link sidebar-item" aria-label="React的生命周期"><!--[--><!--]--> React的生命周期 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/React%20Hooks.html" class="nav-link sidebar-item" aria-label="React Hooks"><!--[--><!--]--> React Hooks <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/react%20performance.html" class="nav-link sidebar-item" aria-label="React 性能优化"><!--[--><!--]--> React 性能优化 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/setState.html" class="nav-link sidebar-item" aria-label="setState 知识点"><!--[--><!--]--> setState 知识点 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/React%20Events.html" class="nav-link sidebar-item" aria-label="React事件机制"><!--[--><!--]--> React事件机制 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/React%20%E7%8A%B6%E6%80%81%E6%9B%B4%E6%96%B0.html" class="nav-link sidebar-item" aria-label="React状态更新"><!--[--><!--]--> React状态更新 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/React%20Scheduler.html" class="nav-link sidebar-item" aria-label="React Scheduler 调度器和优先级"><!--[--><!--]--> React Scheduler 调度器和优先级 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/React%E9%9D%A2%E8%AF%95%E9%A2%98.html" class="nav-link sidebar-item" aria-label="React 面试题"><!--[--><!--]--> React 面试题 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/React%E6%BA%90%E7%A0%81.html" class="nav-link sidebar-item" aria-label="React源码"><!--[--><!--]--> React源码 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/typescript/" class="nav-link sidebar-heading sidebar-item" aria-label="Typescript"><!--[--><!--]--> Typescript <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/typescript/typescript%E9%85%8D%E7%BD%AE.html" class="nav-link sidebar-item" aria-label="typescript配置详解"><!--[--><!--]--> typescript配置详解 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/network/" class="nav-link sidebar-heading sidebar-item" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/network/tcp.html" class="nav-link sidebar-item" aria-label="TCP"><!--[--><!--]--> TCP <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/network/https.html" class="nav-link sidebar-item" aria-label="Https"><!--[--><!--]--> Https <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/network/security.html" class="nav-link sidebar-item" aria-label="web安全"><!--[--><!--]--> web安全 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/nodejs/" class="nav-link sidebar-heading sidebar-item" aria-label="NodeJs"><!--[--><!--]--> NodeJs <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/nodejs/tools.html" class="nav-link sidebar-item" aria-label="Node 常用工具和指令"><!--[--><!--]--> Node 常用工具和指令 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/structure-and-algorithm/" class="nav-link sidebar-heading sidebar-item" aria-label="数据结构与算法"><!--[--><!--]--> 数据结构与算法 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/structure-and-algorithm/%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%88%86%E6%9E%90-%E4%B8%8A.html" class="nav-link sidebar-item" aria-label="时间复杂度"><!--[--><!--]--> 时间复杂度 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/structure-and-algorithm/%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%88%86%E6%9E%90-%E4%B8%8B.html" class="nav-link sidebar-item" aria-label="复杂度分析"><!--[--><!--]--> 复杂度分析 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/structure-and-algorithm/%E6%95%B0%E7%BB%84.html" class="nav-link sidebar-item" aria-label="数组"><!--[--><!--]--> 数组 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/structure-and-algorithm/%E9%93%BE%E8%A1%A8.html" class="nav-link sidebar-item" aria-label="链表"><!--[--><!--]--> 链表 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/structure-and-algorithm/%E6%8E%92%E5%BA%8F.html" class="nav-link sidebar-item" aria-label="排序"><!--[--><!--]--> 排序 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/structure-and-algorithm/%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86.html" class="nav-link sidebar-item" aria-label="二叉树的遍历"><!--[--><!--]--> 二叉树的遍历 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/structure-and-algorithm/%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95.html" class="nav-link sidebar-item" aria-label="回溯算法"><!--[--><!--]--> 回溯算法 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/structure-and-algorithm/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D.html" class="nav-link sidebar-item" aria-label="字符串匹配"><!--[--><!--]--> 字符串匹配 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/structure-and-algorithm/dynamic-programming.html" class="nav-link sidebar-item" aria-label="动态规划"><!--[--><!--]--> 动态规划 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/performance/" class="nav-link sidebar-heading sidebar-item" aria-label="性能优化"><!--[--><!--]--> 性能优化 <!--[--><!--]--></a><!----><!--]--><!--[--><a href="/fe-study/front-end-engineering/what-is-Frond-End-Engineering" class="nav-link sidebar-heading sidebar-item" aria-label="前端工程化"><!--[--><!--]--> 前端工程化 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/front-end-engineering/what-is-Frond-End-Engineering.html" class="nav-link sidebar-item" aria-label="什么是前端工程化？"><!--[--><!--]--> 什么是前端工程化？ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/front-end-engineering/npm%20link.html" class="nav-link sidebar-item" aria-label="npm link"><!--[--><!--]--> npm link <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/front-end-engineering/babel.html" class="nav-link sidebar-item" aria-label="Babel"><!--[--><!--]--> Babel <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/front-end-engineering/jenkins.html" class="nav-link sidebar-item" aria-label="Jenkins配置"><!--[--><!--]--> Jenkins配置 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/front-end-engineering/rollup.html" class="nav-link sidebar-item" aria-label="RollUp"><!--[--><!--]--> RollUp <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/front-end-engineering/lerna.html" class="nav-link sidebar-item" aria-label="基于 Lerna 管理 monorepo 项目"><!--[--><!--]--> 基于 Lerna 管理 monorepo 项目 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/front-end-engineering/vue2%E6%94%B9%E9%80%A0%E4%B8%BAvite%E6%9E%84%E5%BB%BA.html" class="nav-link sidebar-item" aria-label="vue2项目进行vite改造"><!--[--><!--]--> vue2项目进行vite改造 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/front-end-engineering/vconsole.html" class="nav-link sidebar-item" aria-label="vconsole不同环境打包引入"><!--[--><!--]--> vconsole不同环境打包引入 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/programming-design/" class="nav-link sidebar-heading sidebar-item" aria-label="程序设计和场景分析"><!--[--><!--]--> 程序设计和场景分析 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/programming-design/how-to-make-a-game.html" class="nav-link sidebar-item" aria-label="如何制作一个游戏？"><!--[--><!--]--> 如何制作一个游戏？ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/programming-design/how-to-design-a-component-lib.html" class="nav-link sidebar-item" aria-label="如何设计一个组件库"><!--[--><!--]--> 如何设计一个组件库 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/programming-design/how-to-design-a-web-monitor-system.html" class="nav-link sidebar-item" aria-label="如何设计一个前端监控系统"><!--[--><!--]--> 如何设计一个前端监控系统 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/other/" class="nav-link sidebar-heading sidebar-item" aria-label="其他"><!--[--><!--]--> 其他 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/other/indexedDB.html" class="nav-link sidebar-item" aria-label="indexedDB 浏览器数据库"><!--[--><!--]--> indexedDB 浏览器数据库 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/other/vuePress.html" class="nav-link sidebar-item" aria-label="vuePress 使用"><!--[--><!--]--> vuePress 使用 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/other/nginx.html" class="nav-link sidebar-item" aria-label="Nginx概念与使用"><!--[--><!--]--> Nginx概念与使用 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/other/sentry.html" class="nav-link sidebar-item" aria-label="Sentry"><!--[--><!--]--> Sentry <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/awesome/" class="nav-link sidebar-heading sidebar-item" aria-label="收藏的文章"><!--[--><!--]--> 收藏的文章 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/awesome/React.html" class="nav-link sidebar-item" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/awesome/Typescript.html" class="nav-link sidebar-item" aria-label="Typescript"><!--[--><!--]--> Typescript <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/awesome/Taro.html" class="nav-link sidebar-item" aria-label="Taro"><!--[--><!--]--> Taro <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/awesome/concepts.html" class="nav-link sidebar-item" aria-label="前端新概念和趋势"><!--[--><!--]--> 前端新概念和趋势 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/awesome/tools.html" class="nav-link sidebar-item" aria-label="提效工具和网站"><!--[--><!--]--> 提效工具和网站 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/awesome/network.html" class="nav-link sidebar-item" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/awesome/other.html" class="nav-link sidebar-item" aria-label="其他"><!--[--><!--]--> 其他 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="响应式原理" tabindex="-1"><a class="header-anchor" href="#响应式原理" aria-hidden="true">#</a> 响应式原理</h1><p>Vue实例上有一个 <code>data</code> 属性对象，Vue 将遍历这个 <code>data</code> 对象， 使用 <code>Object.defineProperty</code> 把 <code>data</code> 对象上的所有属性全部转换为 <code>getter/setter</code> 。</p><p><code>getter</code> 让Vue能够收集依赖此属性的 <code>watcher</code> 实例，同时在属性被修改时通知所有依赖此属性的 <code>watcher</code> 进行更新。</p><p><a href="https://cn.vuejs.org/v2/guide/reactivity.html" target="_blank" rel="noopener noreferrer">官网原图<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><img src="https://cn.vuejs.org/images/data.png" alt="官网原图"></p><h2 id="观察者模式-发布-订阅模式" tabindex="-1"><a class="header-anchor" href="#观察者模式-发布-订阅模式" aria-hidden="true">#</a> 观察者模式/发布-订阅模式</h2><p>观察者模式又叫发布—订阅模式，它定义了对象之间的一种一对多的依赖关系。当一个对象的状 态发生改变时，所有依赖于它的对象都将得到通知，进而执行相应的操作。</p><blockquote><p>观察者和发布订阅，其实是有差别，但是可以认为两者是一样的，方便理解</p></blockquote><h2 id="vue的实现思路" tabindex="-1"><a class="header-anchor" href="#vue的实现思路" aria-hidden="true">#</a> Vue的实现思路</h2><p>Vue的响应式原理，其实就是一个观察者模式的实现。是通过 <code>Dep</code> <code>Watcher</code> <code>Observer</code> 三者的结合，在初始化的时候收集依赖，在相应属性更改的时候派发更新。</p><p><code>vm.data</code> 中的每一个属性 <code>key</code>，都是一个被观察者。进行响应式声明时，<code>observe</code> 会递归遍历 <code>data</code> 中的每一个属性，巧妙地使用闭包保存了一个Dep的实例（其中 <code>dep.subs</code> 存放的是 <code>watcher</code> 的实例数组）。并通过 <code>defineProperty</code> 改写属性的 <code>getter/setter</code> ，实现数据的劫持。当读取属性的值时，收集相应的依赖到 <code>dep.subs</code> 。进行赋值操作时，调用 <code>dep.notify</code> 进行消息派发。</p><p><code>watcher</code> 作为观察者（订阅者），一般是渲染函数 <code>render</code> 或者 是 <code>computed/watch</code> 的函数。</p><h3 id="源码" tabindex="-1"><a class="header-anchor" href="#源码" aria-hidden="true">#</a> 源码</h3><p>vue实例初始化。 <a href="https://github.com/vuejs/vue/blob/v2.6.14/src/core/instance/init.js#L15" target="_blank" rel="noopener noreferrer">源码<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options<span class="token operator">?</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> vm<span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token comment">// a uid</span>
  vm<span class="token punctuation">.</span>_uid <span class="token operator">=</span> uid<span class="token operator">++</span>

  <span class="token comment">// ...</span>
  vm<span class="token punctuation">.</span>_self <span class="token operator">=</span> vm
  <span class="token function">initLifecycle</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token function">initEvents</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token function">initRender</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">&#39;beforeCreate&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 在 initState 之前，所以此生命周期钩子无法拿到 data</span>
  <span class="token function">initInjections</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve injections before data/props</span>
  <span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// 涉及 data method props compute watch的初始化</span>
  <span class="token function">initProvide</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve provide after data/props</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">&#39;created&#39;</span><span class="token punctuation">)</span>

  <span class="token comment">// ...</span>
  <span class="token comment">// 数据初始化后，当存在dom节点则执行挂载</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>依次初始化 props methods data compute watch。 <a href="https://github.com/vuejs/vue/blob/v2.6.14/src/core/instance/state.js#L49" target="_blank" rel="noopener noreferrer">源码<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><blockquote><p>初始化时会校验 属性名是否已经使用，给出相应的报错提醒</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initState</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token operator">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span>_watchers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> opts <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token function">initProps</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>methods<span class="token punctuation">)</span> <span class="token function">initMethods</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>methods<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initData</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* asRootData */</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>computed<span class="token punctuation">)</span> <span class="token function">initComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>computed<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>watch <span class="token operator">&amp;&amp;</span> opts<span class="token punctuation">.</span>watch <span class="token operator">!==</span> nativeWatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initWatch</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>watch<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><code>initData</code> 方法的目的:</p><ol><li>将 <code>data</code> 的属性代理到 <code>vm</code> 实例上，可以通过 <code>this.</code> 访问和修改</li><li>观察 <code>data</code> 的属性，劫持 <code>getter/setter</code></li></ol><p><a href="https://github.com/vuejs/vue/blob/v2.6.14/src/core/instance/state.js#L113" target="_blank" rel="noopener noreferrer">源码<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">initData</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token operator">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> data <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>data
  <span class="token comment">// 这里判断data到底是对象还是方法。</span>
  <span class="token comment">// 个人感觉这里完全可以只用 function （即 vue根实例的 data 也使用 function 初始化），这样能减少一次判断。</span>
  data <span class="token operator">=</span> vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span>
    <span class="token operator">?</span> <span class="token function">getData</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token operator">:</span> data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// proxy data on instance</span>
  <span class="token comment">// 将data下的属性，代理到 vm实例下，这样就可以通过 this去访问到相应的属性</span>
  <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> keys<span class="token punctuation">.</span>length
  <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token comment">// ...</span>
    <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_data</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// observe data</span>
  <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* asRootData */</span><span class="token punctuation">)</span> <span class="token comment">// 劫持观察该对象</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><a href="https://github.com/vuejs/vue/blob/v2.6.14/src/core/observer/index.js" target="_blank" rel="noopener noreferrer">源码<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 收集依赖，派发更新</span>
<span class="token doc-comment comment">/**
 * Observer class that is attached to each observed
 * object. Once attached, the observer converts the target
 * object&#39;s property keys into getter/setters that
 * collect dependencies and dispatch updates.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> any<span class="token punctuation">;</span>
  dep<span class="token operator">:</span> Dep<span class="token punctuation">;</span>
  vmCount<span class="token operator">:</span> number<span class="token punctuation">;</span> <span class="token comment">// number of vms that have this object as root $data</span>

  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token keyword">this</span><span class="token punctuation">.</span>dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vmCount <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token function">def</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">&#39;__ob__&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token comment">// 分别针对 对象 和 数组，进行单独处理</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>hasProto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">protoAugment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">copyAugment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">,</span> arrayKeys<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token doc-comment comment">/**
   * Walk through all properties and convert them into
   * getter/setters. This method should only be called when
   * value type is Object.
   */</span>
  <span class="token function">walk</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token doc-comment comment">/**
   * Observe a list of Array items.
   */</span>
  <span class="token function">observeArray</span> <span class="token punctuation">(</span><span class="token parameter">items<span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">observe</span><span class="token punctuation">(</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">observe</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> any<span class="token punctuation">,</span> asRootData<span class="token operator">:</span> <span class="token operator">?</span>boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> Observer <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    ob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token comment">// ...</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>asRootData <span class="token operator">&amp;&amp;</span> ob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ob<span class="token punctuation">.</span>vmCount<span class="token operator">++</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> ob
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * Define a reactive property on an Object.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineReactive</span> <span class="token punctuation">(</span>
  <span class="token parameter">obj<span class="token operator">:</span> Object<span class="token punctuation">,</span>
  key<span class="token operator">:</span> string<span class="token punctuation">,</span>
  val<span class="token operator">:</span> any<span class="token punctuation">,</span>
  customSetter<span class="token operator">?</span><span class="token operator">:</span> <span class="token operator">?</span>Function<span class="token punctuation">,</span>
  shallow<span class="token operator">?</span><span class="token operator">:</span> boolean</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 闭包保存一个 dep 实例，主要是保存此属性的所有观察者 watcher</span>
  <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> property <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>configurable <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// cater for pre-defined getter/setters</span>
  <span class="token keyword">const</span> getter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>get
  <span class="token keyword">const</span> setter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>set
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>getter <span class="token operator">||</span> setter<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    val <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 子属性，递归观察</span>
  <span class="token keyword">let</span> childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">:</span> val
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>childOb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          childOb<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">dependArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> value
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveSetter</span> <span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">:</span> val
      <span class="token comment">/* eslint-disable no-self-compare */</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">===</span> value <span class="token operator">||</span> <span class="token punctuation">(</span>newVal <span class="token operator">!==</span> newVal <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      <span class="token comment">/* eslint-enable no-self-compare */</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span> <span class="token operator">&amp;&amp;</span> customSetter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">customSetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// #7981: for accessor properties without setter</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>getter <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>setter<span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>setter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> newVal<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        val <span class="token operator">=</span> newVal
      <span class="token punctuation">}</span>
      childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span>
      <span class="token comment">// 派发更新</span>
      dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br></div></div><h3 id="简写实现" tabindex="-1"><a class="header-anchor" href="#简写实现" aria-hidden="true">#</a> 简写实现</h3><p>在输入框内输入信息，即可看到变化。</p><iframe src="https://codesandbox.io/embed/vue-observe-dep-watcher-drzn8?fontsize=14&amp;hidenavigation=1&amp;theme=dark" style="width:100%;height:500px;border:0;border-radius:4px;overflow:hidden;" title="staging-snow-ij33c" allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"></iframe><h2 id="检测变化的注意事项" tabindex="-1"><a class="header-anchor" href="#检测变化的注意事项" aria-hidden="true">#</a> 检测变化的注意事项</h2><p><a href="https://cn.vuejs.org/v2/guide/reactivity.html#%E6%A3%80%E6%B5%8B%E5%8F%98%E5%8C%96%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" target="_blank" rel="noopener noreferrer">检测变化的注意事项 --- 摘自Vue官网<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p>由于 JavaScript 的限制，Vue 不能检测数组和对象的变化。</p><h3 id="对于对象" tabindex="-1"><a class="header-anchor" href="#对于对象" aria-hidden="true">#</a> 对于对象</h3><p>Vue 无法检测 property 的添加或移除。</p><h3 id="对于数组" tabindex="-1"><a class="header-anchor" href="#对于数组" aria-hidden="true">#</a> 对于数组</h3><p>Vue 不能检测以下数组的变动：</p><ol><li>当你利用索引直接设置一个数组项时，例如：vm.items[indexOfItem] = newValue</li><li>当你修改数组的长度时，例如：vm.items.length = newLength</li></ol><p>数组原型对象上的方法劫持： <a href="https://github.com/vuejs/vue/blob/v2.6.14/src/core/observer/array.js" target="_blank" rel="noopener noreferrer">源码<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> def <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../util/index&#39;</span>

<span class="token keyword">const</span> arrayProto <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype
<span class="token keyword">export</span> <span class="token keyword">const</span> arrayMethods <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>arrayProto<span class="token punctuation">)</span>

<span class="token keyword">const</span> methodsToPatch <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">&#39;push&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;pop&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;shift&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;unshift&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;splice&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;sort&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;reverse&#39;</span>
<span class="token punctuation">]</span>

<span class="token doc-comment comment">/**
 * Intercept mutating methods and emit events
 */</span>
methodsToPatch<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// cache original method</span>
  <span class="token keyword">const</span> original <span class="token operator">=</span> arrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span>
  <span class="token function">def</span><span class="token punctuation">(</span>arrayMethods<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">mutator</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__
    <span class="token keyword">let</span> inserted
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&#39;push&#39;</span><span class="token operator">:</span>
      <span class="token keyword">case</span> <span class="token string">&#39;unshift&#39;</span><span class="token operator">:</span>
        inserted <span class="token operator">=</span> args
        <span class="token keyword">break</span>
      <span class="token keyword">case</span> <span class="token string">&#39;splice&#39;</span><span class="token operator">:</span>
        inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> ob<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span>
    <span class="token comment">// notify change</span>
    ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="附赠面试真题" tabindex="-1"><a class="header-anchor" href="#附赠面试真题" aria-hidden="true">#</a> 附赠面试真题</h3><p>来源自面试真题。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> price<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> quantity<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> target<span class="token punctuation">,</span> total<span class="token punctuation">,</span> salePrice<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>
    <span class="token comment">// write your code here</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token function">depend</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// write your code here</span>
    <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> value <span class="token operator">=</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> value
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">set</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            value <span class="token operator">=</span> val
            dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">watcher</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// write your code here</span>
    target <span class="token operator">=</span> fn
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    target <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>

<span class="token function">watcher</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    total <span class="token operator">=</span> data<span class="token punctuation">.</span>price <span class="token operator">*</span> data<span class="token punctuation">.</span>quantity<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">watcher</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    salePrice <span class="token operator">=</span> data<span class="token punctuation">.</span>price <span class="token operator">*</span> <span class="token number">0.9</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">initial total: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>total<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">initial salePrice: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>salePrice<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

data<span class="token punctuation">.</span>price <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">total: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>total<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// total: 20</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">salePrice: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>salePrice<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// salePrice: 9</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h2 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料" aria-hidden="true">#</a> 参考资料</h2><p><a href="https://cn.vuejs.org/v2/guide/reactivity.html" target="_blank" rel="noopener noreferrer">深入响应式原理 --- Vue2官网<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">9/12/2022, 5:33:14 AM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: zhs25427199@gmail.com">vandvassily</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/fe-study/vue/lifeCircle.html" class="nav-link" aria-label="Vue生命周期"><!--[--><!--]--> Vue生命周期 <!--[--><!--]--></a></span><span class="next"><a href="/fe-study/vue/nextTick.html" class="nav-link" aria-label="异步更新队列"><!--[--><!--]--> 异步更新队列 <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/fe-study/assets/app.9bc35547.js" defer></script>
  </body>
</html>
