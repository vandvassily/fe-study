import{r as e,c as t,a as n,d as p,F as o,b as s,e as c,o as l}from"./app.9bc35547.js";import{_ as u}from"./plugin-vue_export-helper.5a098b48.js";const r={},k=n("h1",{id:"keep-alive-\u7EC4\u4EF6",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#keep-alive-\u7EC4\u4EF6","aria-hidden":"true"},"#"),s(" keep-alive \u7EC4\u4EF6")],-1),i=n("p",null,[n("code",null,"keep-alive"),s(" \u662F\u5B98\u65B9\u63D0\u4F9B\u7684\u7EC4\u4EF6\u3002\u76EE\u7684\u662F\u7528\u4E8E\u4FDD\u7559\u7EC4\u4EF6\u7684\u72B6\u6001\u6216\u907F\u514D\u91CD\u590D\u6E32\u67D3\u5F15\u53D1\u7684\u6027\u80FD\u95EE\u9898\u3002")],-1),m=n("h2",{id:"\u6E90\u7801\u89E3\u6790",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u6E90\u7801\u89E3\u6790","aria-hidden":"true"},"#"),s(" \u6E90\u7801\u89E3\u6790")],-1),b={href:"https://github.com/vuejs/vue/blob/v2.6.14/src/core/components/keep-alive.js",target:"_blank",rel:"noopener noreferrer"},d=s("\u7EC4\u4EF6\u6E90\u7801"),h=c(`<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&#39;keep-alive&#39;</span><span class="token punctuation">,</span>
  abstract<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// \u62BD\u8C61\u7EC4\u4EF6\uFF0C\u5E76\u4E0D\u4F1A\u6E32\u67D3\u4E3A\u5B9E\u9645DOM</span>

  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    include<span class="token operator">:</span> patternTypes<span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> patternTypes<span class="token punctuation">,</span>
    max<span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">,</span> Number<span class="token punctuation">]</span> <span class="token comment">// \u6700\u5927\u7F13\u5B58\u6570</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">cacheVNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u7F13\u5B58\u8282\u70B9 vnode</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> cache<span class="token punctuation">,</span> keys<span class="token punctuation">,</span> vnodeToCache<span class="token punctuation">,</span> keyToCache <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>vnodeToCache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> tag<span class="token punctuation">,</span> componentInstance<span class="token punctuation">,</span> componentOptions <span class="token punctuation">}</span> <span class="token operator">=</span> vnodeToCache
        cache<span class="token punctuation">[</span>keyToCache<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token function">getComponentName</span><span class="token punctuation">(</span>componentOptions<span class="token punctuation">)</span><span class="token punctuation">,</span>
          tag<span class="token punctuation">,</span>
          componentInstance<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>keyToCache<span class="token punctuation">)</span>
        <span class="token comment">// prune oldest entry</span>
        <span class="token comment">// \u5982\u679C\u8D85\u8FC7\u8BBE\u7F6E\u7684\u6700\u5927\u7F13\u5B58\u6570\uFF0C\u5219\u79FB\u8D70\u6700\u65E9\u7684\u8282\u70B9\uFF0C\u5373 keys[0]</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>max <span class="token operator">&amp;&amp;</span> keys<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">pruneCacheEntry</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> keys<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_vnode<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>vnodeToCache <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u521D\u59CB\u6362keep-alive\u7EC4\u4EF6\uFF0C\u521B\u5EFA\u4E00\u4E2A\u7A7A\u5BF9\u8C61 cache\uFF0C\u7528\u4E8E\u4FDD\u5B58 vnode</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token comment">// \u7A7A\u6570\u7EC4\uFF0C\u7528\u4E8E\u4FDD\u5B58\u8BBF\u95EE\u7684\u987A\u5E8F\uFF0C\u4EE5\u4FBF\u5220\u9664\u548C\u79FB\u52A8\uFF1B\u987A\u5E8F\u4E3A\uFF1A \u6700\u5148\u8BBF\u95EE -&gt; \u6700\u8FD1\u8BBF\u95EE</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">destroyed</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">pruneCacheEntry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>keys<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cacheVNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// \u6839\u636E\u5339\u914D\u89C4\u5219\uFF0C\u79FB\u9664\u76F8\u5E94\u7F13\u5B58\u7684 vnode</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">&#39;include&#39;</span><span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">pruneCache</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token function">matches</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">&#39;exclude&#39;</span><span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">pruneCache</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token function">matches</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">updated</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// updated \u94A9\u5B50\u540E\uFF0C\u53CA\u65F6\u66F4\u65B0\u7F13\u5B58</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cacheVNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> slot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default
    <span class="token keyword">const</span> vnode<span class="token operator">:</span> VNode <span class="token operator">=</span> <span class="token function">getFirstComponentChild</span><span class="token punctuation">(</span>slot<span class="token punctuation">)</span>
    <span class="token keyword">const</span> componentOptions<span class="token operator">:</span> <span class="token operator">?</span>VNodeComponentOptions <span class="token operator">=</span> vnode <span class="token operator">&amp;&amp;</span> vnode<span class="token punctuation">.</span>componentOptions
    <span class="token keyword">if</span> <span class="token punctuation">(</span>componentOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// check pattern</span>
      <span class="token keyword">const</span> name<span class="token operator">:</span> <span class="token operator">?</span>string <span class="token operator">=</span> <span class="token function">getComponentName</span><span class="token punctuation">(</span>componentOptions<span class="token punctuation">)</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> include<span class="token punctuation">,</span> exclude <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token comment">// not included</span>
        <span class="token punctuation">(</span>include <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">matches</span><span class="token punctuation">(</span>include<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
        <span class="token comment">// excluded</span>
        <span class="token punctuation">(</span>exclude <span class="token operator">&amp;&amp;</span> name <span class="token operator">&amp;&amp;</span> <span class="token function">matches</span><span class="token punctuation">(</span>exclude<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> vnode
      <span class="token punctuation">}</span>

      <span class="token keyword">const</span> <span class="token punctuation">{</span> cache<span class="token punctuation">,</span> keys <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">const</span> key<span class="token operator">:</span> <span class="token operator">?</span>string <span class="token operator">=</span> vnode<span class="token punctuation">.</span>key <span class="token operator">==</span> <span class="token keyword">null</span>
        <span class="token comment">// same constructor may get registered as different local components</span>
        <span class="token comment">// so cid alone is not enough (#3269)</span>
        <span class="token operator">?</span> componentOptions<span class="token punctuation">.</span>Ctor<span class="token punctuation">.</span>cid <span class="token operator">+</span> <span class="token punctuation">(</span>componentOptions<span class="token punctuation">.</span>tag <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">::</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>componentOptions<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> vnode<span class="token punctuation">.</span>key
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vnode<span class="token punctuation">.</span>componentInstance <span class="token operator">=</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>componentInstance
        <span class="token comment">// make current key freshest</span>
        <span class="token comment">// \u66F4\u65B0\u6B64 vnode \u5728\u6570\u7EC4\u4E2D\u7684\u987A\u5E8F\u3002\u5148\u79FB\u9664\uFF0C\u518Dpush\u5230\u6700\u540E</span>
        <span class="token function">remove</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
        keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// delay setting the cache until update</span>
        <span class="token comment">// \u5982\u679C\u7F13\u5B58\u4E0D\u5B58\u5728\uFF0C\u5219\u5C06\u9700\u8981\u4FDD\u5B58\u7684 vnode \u548C key \u653E\u5230\u7EC4\u4EF6 updated \u94A9\u5B50\u540E\u8FDB\u884C\u66F4\u65B0</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>vnodeToCache <span class="token operator">=</span> vnode
        <span class="token keyword">this</span><span class="token punctuation">.</span>keyToCache <span class="token operator">=</span> key
      <span class="token punctuation">}</span>

      vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>keepAlive <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> vnode <span class="token operator">||</span> <span class="token punctuation">(</span>slot <span class="token operator">&amp;&amp;</span> slot<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br></div></div><p><code>keep-alive</code> \u7EC4\u4EF6\u662F\u4E00\u4E2A <code>abstract</code> \u62BD\u8C61\u7EC4\u4EF6\uFF0C\u5E76\u4E0D\u4F1A\u6E32\u67D3\u4E3A <code>DOM</code> \u8282\u70B9\u3002</p><p>\u521D\u59CB\u5316 <code>keep-alive</code> \u7EC4\u4EF6\u65F6\uFF0C\u4F1A\u521B\u5EFA <code>cache</code> \u548C <code>keys</code> \uFF0C\u5206\u522B\u7528\u4E8E\u4FDD\u5B58 <code>vnode</code> \u548C <code>vnode</code> \u7684\u8BBF\u95EE\u987A\u5E8F\u3002</p><blockquote><p>\u57FA\u4E8E <code>LRU(Least Recently Used)</code> \u6700\u8FD1\u6700\u5C11\u4F7F\u7528\u7B97\u6CD5\uFF0C\u4FDD\u5B58 \u88AB\u5305\u88F9\u7EC4\u4EF6 \u7684\u72B6\u6001 <code>vnode</code>\u3002</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>  <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u521D\u59CB\u6362keep-alive\u7EC4\u4EF6\uFF0C\u521B\u5EFA\u4E00\u4E2A\u7A7A\u5BF9\u8C61 cache\uFF0C\u7528\u4E8E\u4FDD\u5B58 vnode</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token comment">// \u7A7A\u6570\u7EC4\uFF0C\u7528\u4E8E\u4FDD\u5B58\u8BBF\u95EE\u7684\u987A\u5E8F\uFF0C\u4EE5\u4FBF\u5220\u9664\u548C\u79FB\u52A8\uFF1B\u987A\u5E8F\u4E3A\uFF1A \u6700\u5148\u8BBF\u95EE -&gt; \u6700\u8FD1\u8BBF\u95EE</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u5728 <code>Vue</code> \u7EC4\u4EF6\u4E2D\uFF0C <code>render</code> \u65B9\u6CD5\u8FD4\u56DE\u7684\u662F\u865A\u62DF\u8282\u70B9 <code>vnode</code> \u3002<code>vnode</code> \u7528\u4E8E\u4E4B\u540E\u7684 <code>patchVnode</code> \uFF0C\u8282\u70B9\u5BF9\u6BD4\u8FC7\u7A0B\u4E2D\uFF0C\u4F1A\u4E0D\u65AD\u5730\u64CD\u4F5C\u771F\u5B9E <code>DOM</code> \u3002</p><p><code>keep-alive</code> \u7EC4\u4EF6\u4E2D\u7684 <code>render</code> \u65B9\u6CD5\uFF0C\u8FD4\u56DE\u7684\u4E5F\u662F <code>vnode</code> \uFF0C\u4E0D\u8FC7\u8FD4\u56DE\u7684\u662F\u7EC4\u4EF6\u5185\u7B2C\u4E00\u4E2A\u6709\u6548\u5B50\u8282\u70B9\u7684 <code>vnode</code> \u3002 <code>render</code> \u65B9\u6CD5\u4E2D\uFF0C\u901A\u8FC7 <code>LRU</code> \u7B97\u6CD5\u83B7\u5F97\u3001\u66F4\u65B0\u7F13\u5B58 <code>cache</code> \u548C <code>keys</code> \uFF0C\u590D\u7528\u4E4B\u524D\u751F\u6210\u7684 <code>vnode</code> \uFF0C\u51CF\u5C11\u4E86\u91CD\u590D\u6E32\u67D3\u7684\u64CD\u4F5C\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> slot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default
    <span class="token comment">// \u7EC4\u4EF6\u5185\u7B2C\u4E00\u4E2A\u6709\u6548\u5B50\u8282\u70B9</span>
    <span class="token keyword">const</span> vnode<span class="token operator">:</span> VNode <span class="token operator">=</span> <span class="token function">getFirstComponentChild</span><span class="token punctuation">(</span>slot<span class="token punctuation">)</span>
    <span class="token keyword">const</span> componentOptions<span class="token operator">:</span> <span class="token operator">?</span>VNodeComponentOptions <span class="token operator">=</span> vnode <span class="token operator">&amp;&amp;</span> vnode<span class="token punctuation">.</span>componentOptions
    <span class="token keyword">if</span> <span class="token punctuation">(</span>componentOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// check pattern</span>
      <span class="token comment">// \u5339\u914D\u89C4\u5219</span>
      <span class="token keyword">const</span> name<span class="token operator">:</span> <span class="token operator">?</span>string <span class="token operator">=</span> <span class="token function">getComponentName</span><span class="token punctuation">(</span>componentOptions<span class="token punctuation">)</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> include<span class="token punctuation">,</span> exclude <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token comment">// not included</span>
        <span class="token punctuation">(</span>include <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">matches</span><span class="token punctuation">(</span>include<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
        <span class="token comment">// excluded</span>
        <span class="token punctuation">(</span>exclude <span class="token operator">&amp;&amp;</span> name <span class="token operator">&amp;&amp;</span> <span class="token function">matches</span><span class="token punctuation">(</span>exclude<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> vnode
      <span class="token punctuation">}</span>

      <span class="token comment">// \u5224\u65AD\u662F\u5426\u5DF2\u5B58\u5728 cache \u4E2D</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> cache<span class="token punctuation">,</span> keys <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">const</span> key<span class="token operator">:</span> <span class="token operator">?</span>string <span class="token operator">=</span> vnode<span class="token punctuation">.</span>key <span class="token operator">==</span> <span class="token keyword">null</span>
        <span class="token comment">// same constructor may get registered as different local components</span>
        <span class="token comment">// so cid alone is not enough (#3269)</span>
        <span class="token operator">?</span> componentOptions<span class="token punctuation">.</span>Ctor<span class="token punctuation">.</span>cid <span class="token operator">+</span> <span class="token punctuation">(</span>componentOptions<span class="token punctuation">.</span>tag <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">::</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>componentOptions<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> vnode<span class="token punctuation">.</span>key
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u62FF\u7F13\u5B58\u4E2D\u7684componentInstance \u66FF\u6362\u73B0\u6709 vnode \u7684 componentInstance</span>
        vnode<span class="token punctuation">.</span>componentInstance <span class="token operator">=</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>componentInstance
        <span class="token comment">// make current key freshest</span>
        <span class="token comment">// \u66F4\u65B0\u6B64 vnode \u5728\u6570\u7EC4\u4E2D\u7684\u987A\u5E8F\u3002\u5148\u79FB\u9664\uFF0C\u518Dpush\u5230\u6700\u540E</span>
        <span class="token function">remove</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
        keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// delay setting the cache until update</span>
        <span class="token comment">// \u5982\u679C\u7F13\u5B58\u4E0D\u5B58\u5728\uFF0C\u5219\u5C06\u9700\u8981\u4FDD\u5B58\u7684 vnode \u548C key \u653E\u5230\u7EC4\u4EF6 updated \u94A9\u5B50\u540E\u8FDB\u884C\u66F4\u65B0</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>vnodeToCache <span class="token operator">=</span> vnode
        <span class="token keyword">this</span><span class="token punctuation">.</span>keyToCache <span class="token operator">=</span> key
      <span class="token punctuation">}</span>

      vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>keepAlive <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> vnode <span class="token operator">||</span> <span class="token punctuation">(</span>slot <span class="token operator">&amp;&amp;</span> slot<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>// TODO</p>`,9),y=n("code",null,"componentVNodeHooks",-1),v=s(),f={href:"https://github.com/vuejs/vue/blob/v2.6.14/src/core/vdom/create-component.js#L35",target:"_blank",rel:"noopener noreferrer"},w=s("\u6E90\u7801"),g=n("code",null,"prepatch ",-1),_=s(),C={href:"https://github.com/vuejs/vue/blob/v2.6.14/src/core/vdom/create-component.js#L55",target:"_blank",rel:"noopener noreferrer"},O=s("\u6E90\u7801"),x=n("code",null,"updateChildComponent",-1),j=s(),N={href:"https://github.com/vuejs/vue/blob/v2.6.14/src/core/instance/lifecycle.js#215",target:"_blank",rel:"noopener noreferrer"},T=s("\u6E90\u7801");function V(I,L){const a=e("OutboundLink");return l(),t(o,null,[k,i,m,n("p",null,[n("a",b,[d,p(a)])]),h,n("ol",null,[n("li",null,[y,v,n("a",f,[w,p(a)])]),n("li",null,[g,_,n("a",C,[O,p(a)])]),n("li",null,[x,j,n("a",N,[T,p(a)])])])],64)}var F=u(r,[["render",V]]);export{F as default};
