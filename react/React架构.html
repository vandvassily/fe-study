<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/favicon.ico"><title>React 架构 | fe-study</title><meta name="description" content="前端知识笔记">
    <link rel="modulepreload" href="/fe-study/assets/app.9bc35547.js"><link rel="modulepreload" href="/fe-study/assets/React架构.html.460dc67f.js"><link rel="modulepreload" href="/fe-study/assets/plugin-vue_export-helper.5a098b48.js"><link rel="modulepreload" href="/fe-study/assets/React架构.html.b2600951.js">
    <link rel="stylesheet" href="/fe-study/assets/style.2c625487.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/fe-study/" class=""><!----><span class="site-name can-hide">fe-study</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/fe-study/" class="nav-link" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="http://vandvassily.cn/" rel="noopener noreferrer" target="_blank" aria-label="Blog"><!--[--><!--]--> Blog <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/vandvassily/fe-study" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/fe-study/" class="nav-link" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="http://vandvassily.cn/" rel="noopener noreferrer" target="_blank" aria-label="Blog"><!--[--><!--]--> Blog <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/vandvassily/fe-study" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><a href="/fe-study/javascript/" class="nav-link sidebar-heading sidebar-item" aria-label="JS知识"><!--[--><!--]--> JS知识 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/javascript/basic/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html" class="nav-link sidebar-item" aria-label="数据类型"><!--[--><!--]--> 数据类型 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/%E5%8E%9F%E5%9E%8B.html" class="nav-link sidebar-item" aria-label="原型、原型链、继承"><!--[--><!--]--> 原型、原型链、继承 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/%E8%AF%8D%E6%B3%95%E4%BD%9C%E7%94%A8%E5%9F%9F.html" class="nav-link sidebar-item" aria-label="词法作用域"><!--[--><!--]--> 词法作用域 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87.html" class="nav-link sidebar-item" aria-label="执行上下文"><!--[--><!--]--> 执行上下文 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E6%A0%88.html" class="nav-link sidebar-item" aria-label="JavaScript深入之执行上下文栈"><!--[--><!--]--> JavaScript深入之执行上下文栈 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE.html" class="nav-link sidebar-item" aria-label="作用域链"><!--[--><!--]--> 作用域链 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/this.html" class="nav-link sidebar-item" aria-label="this"><!--[--><!--]--> this <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/new.html" class="nav-link sidebar-item" aria-label="new 的原理"><!--[--><!--]--> new 的原理 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/call%20apply%20bind.html" class="nav-link sidebar-item" aria-label="call apply bind"><!--[--><!--]--> call apply bind <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/EventLoop.html" class="nav-link sidebar-item" aria-label="EventLoop 事件循环"><!--[--><!--]--> EventLoop 事件循环 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/array.html" class="nav-link sidebar-item" aria-label="数组方法"><!--[--><!--]--> 数组方法 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/currying.html" class="nav-link sidebar-item" aria-label="函数柯里化"><!--[--><!--]--> 函数柯里化 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/basic/%E6%B7%B1%E6%8B%B7%E8%B4%9D.html" class="nav-link sidebar-item" aria-label="深拷贝"><!--[--><!--]--> 深拷贝 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/javascript/usage/debounce-throttle.html" class="nav-link sidebar-item" aria-label="防抖 与 节流"><!--[--><!--]--> 防抖 与 节流 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/browser/" class="nav-link sidebar-heading sidebar-item" aria-label="浏览器"><!--[--><!--]--> 浏览器 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/browser/%E8%BE%93%E5%85%A5URL.html" class="nav-link sidebar-item" aria-label="输入URL后，发生了什么"><!--[--><!--]--> 输入URL后，发生了什么 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/vue/" class="nav-link sidebar-heading sidebar-item" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/vue/lifeCircle.html" class="nav-link sidebar-item" aria-label="Vue生命周期"><!--[--><!--]--> Vue生命周期 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/vue/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html" class="nav-link sidebar-item" aria-label="响应式原理"><!--[--><!--]--> 响应式原理 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/vue/nextTick.html" class="nav-link sidebar-item" aria-label="异步更新队列"><!--[--><!--]--> 异步更新队列 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/vue/watcher.html" class="nav-link sidebar-item" aria-label="computed 和 watch 的原理"><!--[--><!--]--> computed 和 watch 的原理 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/vue/diff.html" class="nav-link sidebar-item" aria-label="Diff算法"><!--[--><!--]--> Diff算法 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/vue/keep-alive.html" class="nav-link sidebar-item" aria-label="keep-alive 组件"><!--[--><!--]--> keep-alive 组件 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/vue/Vue3.html" class="nav-link sidebar-item" aria-label="Vue3"><!--[--><!--]--> Vue3 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/react/" class="nav-link router-link-active sidebar-heading sidebar-item active" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a><ul class=""><li><!--[--><a aria-current="page" href="/fe-study/react/React%E6%9E%B6%E6%9E%84.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="React 架构"><!--[--><!--]--> React 架构 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/fe-study/react/React%E6%9E%B6%E6%9E%84.html#react15架构" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="React15架构"><!--[--><!--]--> React15架构 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/fe-study/react/React%E6%9E%B6%E6%9E%84.html#react16架构" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="React16架构"><!--[--><!--]--> React16架构 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/fe-study/react/React%E6%9E%B6%E6%9E%84.html#scheduler-调度器" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Scheduler 调度器"><!--[--><!--]--> Scheduler 调度器 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/fe-study/react/React%E6%9E%B6%E6%9E%84.html#reconciler-协调器" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Reconciler 协调器"><!--[--><!--]--> Reconciler 协调器 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/fe-study/react/React%E6%9E%B6%E6%9E%84.html#renderer-渲染器" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Renderer 渲染器"><!--[--><!--]--> Renderer 渲染器 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/fe-study/react/React%E6%9E%B6%E6%9E%84.html#fiber" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Fiber"><!--[--><!--]--> Fiber <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/fe-study/react/React%E6%9E%B6%E6%9E%84.html#fiber的含义" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Fiber的含义"><!--[--><!--]--> Fiber的含义 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/fe-study/react/React%E6%9E%B6%E6%9E%84.html#fiber结构" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Fiber结构"><!--[--><!--]--> Fiber结构 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/fe-study/react/React%E6%9E%B6%E6%9E%84.html#fiber双缓存" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Fiber双缓存"><!--[--><!--]--> Fiber双缓存 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/fe-study/react/React%E6%9E%B6%E6%9E%84.html#react-fiber-是如何工作的" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="React Fiber 是如何工作的？"><!--[--><!--]--> React Fiber 是如何工作的？ <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/fe-study/react/React%E6%9E%B6%E6%9E%84.html#参考文章" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="参考文章"><!--[--><!--]--> 参考文章 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/fe-study/react/jsx.html" class="nav-link sidebar-item" aria-label="JSX是什么？"><!--[--><!--]--> JSX是什么？ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/lifecircle.html" class="nav-link sidebar-item" aria-label="React的生命周期"><!--[--><!--]--> React的生命周期 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/React%20Hooks.html" class="nav-link sidebar-item" aria-label="React Hooks"><!--[--><!--]--> React Hooks <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/react%20performance.html" class="nav-link sidebar-item" aria-label="React 性能优化"><!--[--><!--]--> React 性能优化 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/setState.html" class="nav-link sidebar-item" aria-label="setState 知识点"><!--[--><!--]--> setState 知识点 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/React%20Events.html" class="nav-link sidebar-item" aria-label="React事件机制"><!--[--><!--]--> React事件机制 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/React%20%E7%8A%B6%E6%80%81%E6%9B%B4%E6%96%B0.html" class="nav-link sidebar-item" aria-label="React状态更新"><!--[--><!--]--> React状态更新 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/React%20Scheduler.html" class="nav-link sidebar-item" aria-label="React Scheduler 调度器和优先级"><!--[--><!--]--> React Scheduler 调度器和优先级 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/React%E9%9D%A2%E8%AF%95%E9%A2%98.html" class="nav-link sidebar-item" aria-label="React 面试题"><!--[--><!--]--> React 面试题 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/react/React%E6%BA%90%E7%A0%81.html" class="nav-link sidebar-item" aria-label="React源码"><!--[--><!--]--> React源码 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/typescript/" class="nav-link sidebar-heading sidebar-item" aria-label="Typescript"><!--[--><!--]--> Typescript <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/typescript/typescript%E9%85%8D%E7%BD%AE.html" class="nav-link sidebar-item" aria-label="typescript配置详解"><!--[--><!--]--> typescript配置详解 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/network/" class="nav-link sidebar-heading sidebar-item" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/network/tcp.html" class="nav-link sidebar-item" aria-label="TCP"><!--[--><!--]--> TCP <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/network/https.html" class="nav-link sidebar-item" aria-label="Https"><!--[--><!--]--> Https <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/network/security.html" class="nav-link sidebar-item" aria-label="web安全"><!--[--><!--]--> web安全 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/nodejs/" class="nav-link sidebar-heading sidebar-item" aria-label="NodeJs"><!--[--><!--]--> NodeJs <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/nodejs/tools.html" class="nav-link sidebar-item" aria-label="Node 常用工具和指令"><!--[--><!--]--> Node 常用工具和指令 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/structure-and-algorithm/" class="nav-link sidebar-heading sidebar-item" aria-label="数据结构与算法"><!--[--><!--]--> 数据结构与算法 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/structure-and-algorithm/%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%88%86%E6%9E%90-%E4%B8%8A.html" class="nav-link sidebar-item" aria-label="时间复杂度"><!--[--><!--]--> 时间复杂度 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/structure-and-algorithm/%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%88%86%E6%9E%90-%E4%B8%8B.html" class="nav-link sidebar-item" aria-label="复杂度分析"><!--[--><!--]--> 复杂度分析 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/structure-and-algorithm/%E6%95%B0%E7%BB%84.html" class="nav-link sidebar-item" aria-label="数组"><!--[--><!--]--> 数组 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/structure-and-algorithm/%E9%93%BE%E8%A1%A8.html" class="nav-link sidebar-item" aria-label="链表"><!--[--><!--]--> 链表 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/structure-and-algorithm/%E6%8E%92%E5%BA%8F.html" class="nav-link sidebar-item" aria-label="排序"><!--[--><!--]--> 排序 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/structure-and-algorithm/%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86.html" class="nav-link sidebar-item" aria-label="二叉树的遍历"><!--[--><!--]--> 二叉树的遍历 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/structure-and-algorithm/%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95.html" class="nav-link sidebar-item" aria-label="回溯算法"><!--[--><!--]--> 回溯算法 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/structure-and-algorithm/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D.html" class="nav-link sidebar-item" aria-label="字符串匹配"><!--[--><!--]--> 字符串匹配 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/structure-and-algorithm/dynamic-programming.html" class="nav-link sidebar-item" aria-label="动态规划"><!--[--><!--]--> 动态规划 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/performance/" class="nav-link sidebar-heading sidebar-item" aria-label="性能优化"><!--[--><!--]--> 性能优化 <!--[--><!--]--></a><!----><!--]--><!--[--><a href="/fe-study/front-end-engineering/what-is-Frond-End-Engineering" class="nav-link sidebar-heading sidebar-item" aria-label="前端工程化"><!--[--><!--]--> 前端工程化 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/front-end-engineering/what-is-Frond-End-Engineering.html" class="nav-link sidebar-item" aria-label="什么是前端工程化？"><!--[--><!--]--> 什么是前端工程化？ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/front-end-engineering/npm%20link.html" class="nav-link sidebar-item" aria-label="npm link"><!--[--><!--]--> npm link <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/front-end-engineering/babel.html" class="nav-link sidebar-item" aria-label="Babel"><!--[--><!--]--> Babel <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/front-end-engineering/jenkins.html" class="nav-link sidebar-item" aria-label="Jenkins配置"><!--[--><!--]--> Jenkins配置 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/front-end-engineering/rollup.html" class="nav-link sidebar-item" aria-label="RollUp"><!--[--><!--]--> RollUp <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/front-end-engineering/lerna.html" class="nav-link sidebar-item" aria-label="基于 Lerna 管理 monorepo 项目"><!--[--><!--]--> 基于 Lerna 管理 monorepo 项目 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/front-end-engineering/vue2%E6%94%B9%E9%80%A0%E4%B8%BAvite%E6%9E%84%E5%BB%BA.html" class="nav-link sidebar-item" aria-label="vue2项目进行vite改造"><!--[--><!--]--> vue2项目进行vite改造 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/front-end-engineering/vconsole.html" class="nav-link sidebar-item" aria-label="vconsole不同环境打包引入"><!--[--><!--]--> vconsole不同环境打包引入 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/programming-design/" class="nav-link sidebar-heading sidebar-item" aria-label="程序设计和场景分析"><!--[--><!--]--> 程序设计和场景分析 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/programming-design/how-to-make-a-game.html" class="nav-link sidebar-item" aria-label="如何制作一个游戏？"><!--[--><!--]--> 如何制作一个游戏？ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/programming-design/how-to-design-a-component-lib.html" class="nav-link sidebar-item" aria-label="如何设计一个组件库"><!--[--><!--]--> 如何设计一个组件库 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/programming-design/how-to-design-a-web-monitor-system.html" class="nav-link sidebar-item" aria-label="如何设计一个前端监控系统"><!--[--><!--]--> 如何设计一个前端监控系统 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/other/" class="nav-link sidebar-heading sidebar-item" aria-label="其他"><!--[--><!--]--> 其他 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/other/indexedDB.html" class="nav-link sidebar-item" aria-label="indexedDB 浏览器数据库"><!--[--><!--]--> indexedDB 浏览器数据库 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/other/vuePress.html" class="nav-link sidebar-item" aria-label="vuePress 使用"><!--[--><!--]--> vuePress 使用 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/other/nginx.html" class="nav-link sidebar-item" aria-label="Nginx概念与使用"><!--[--><!--]--> Nginx概念与使用 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/other/sentry.html" class="nav-link sidebar-item" aria-label="Sentry"><!--[--><!--]--> Sentry <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/fe-study/awesome/" class="nav-link sidebar-heading sidebar-item" aria-label="收藏的文章"><!--[--><!--]--> 收藏的文章 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/fe-study/awesome/React.html" class="nav-link sidebar-item" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/awesome/Typescript.html" class="nav-link sidebar-item" aria-label="Typescript"><!--[--><!--]--> Typescript <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/awesome/Taro.html" class="nav-link sidebar-item" aria-label="Taro"><!--[--><!--]--> Taro <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/awesome/concepts.html" class="nav-link sidebar-item" aria-label="前端新概念和趋势"><!--[--><!--]--> 前端新概念和趋势 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/awesome/tools.html" class="nav-link sidebar-item" aria-label="提效工具和网站"><!--[--><!--]--> 提效工具和网站 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/awesome/network.html" class="nav-link sidebar-item" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/fe-study/awesome/other.html" class="nav-link sidebar-item" aria-label="其他"><!--[--><!--]--> 其他 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="react-架构" tabindex="-1"><a class="header-anchor" href="#react-架构" aria-hidden="true">#</a> React 架构</h1><h2 id="react15架构" tabindex="-1"><a class="header-anchor" href="#react15架构" aria-hidden="true">#</a> React15架构</h2><p>分为两层：</p><ul><li>&#39;Stack&#39; Reconciler(协调器) ---- 负责找出变化的组件</li><li>Renderer(渲染器) --- 负责将变化的组件渲染到页面上</li></ul><div class="custom-container tip"><p class="custom-container-title">提示</p><p>注意，体会 <strong>Stack</strong> 这个词。<a href="https://zh-hans.reactjs.org/docs/implementation-notes.html" target="_blank" rel="noopener noreferrer">官网说明<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p>15架构的缺点是，组件递归更新，更新一旦开始，中途就无法中断。当递归的层级很深，更新时间超过16ms，用户的交互就会卡顿。 解决方案：用可中断的异步更新代替同步更新。</p></div><h2 id="react16架构" tabindex="-1"><a class="header-anchor" href="#react16架构" aria-hidden="true">#</a> React16架构</h2><p>分为三层：</p><ul><li>Scheduler（调度器）—— 调度任务的优先级，高优任务优先进入Reconciler</li><li>&#39;Fiber&#39; Reconciler（协调器）—— 负责找出变化的组件，并打上不同的Flags</li><li>Renderer（渲染器）—— 负责将变化的组件渲染到页面上</li></ul><blockquote><p>使用了最新的 <strong>Fiber</strong> 架构</p></blockquote><h3 id="scheduler-调度器" tabindex="-1"><a class="header-anchor" href="#scheduler-调度器" aria-hidden="true">#</a> Scheduler 调度器</h3><p>调度器的作用是，当浏览器有剩余时间的时候通知我们，在浏览器空闲时出发回调，同时还提供了多种调度任务优先级供任务设置。优先级工作分为 高优先级（动画） 和 低优先级的工作（大型计算函数）。调度可以基于时间或者优先级，高优先级的工作应该被安排在低优先级的工作之上。</p><blockquote><p>// TODO 如何调度？</p><ul><li>任务的优先级，使用任务的过期时间表示</li><li>任务队列中，使用的是小顶堆 <code>SchedulerMinHeap.js</code></li><li>现在的版本中，采用 <code>Lane</code> 模型来处理任务的优先级</li></ul></blockquote><h3 id="reconciler-协调器" tabindex="-1"><a class="header-anchor" href="#reconciler-协调器" aria-hidden="true">#</a> Reconciler 协调器</h3><p><code>Fiber Reconciler</code> 是 <code>React 16</code> 中新的协调算法。 协调器是在 render 阶段工作。会创建和更新Fiber节点。在mount阶段，生成Fiber对象，在update时，会更新最新的state形成的jsx对象和current Fiber树对比复用，构建 workInProgress Fiber 树。</p><blockquote><p>这个对比的过程就是 diff 算法。</p><ul><li>diff算法发生在render阶段的 reconcileChildFibers 中。</li><li>diff分为：单节点和多节点的</li></ul></blockquote><ul><li>能够把可中断的任务切片处理。</li><li>能够调整优先级，重置并复用任务。</li><li>能够在父元素与子元素之间交错处理，以支持 React 中的布局。</li><li>能够在 <code>render()</code> 中返回多个元素。</li><li>更好地支持错误边界。</li></ul><blockquote><p><a href="https://zh-hans.reactjs.org/docs/codebase-overview.html#reconcilers" target="_blank" rel="noopener noreferrer">reconcilers--官网<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p></blockquote><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>整个Scheduler与Reconciler的工作都在<strong>内存</strong>中进行。只有当所有组件都完成Reconciler的工作，才会统一交给Renderer。</p></div><h3 id="renderer-渲染器" tabindex="-1"><a class="header-anchor" href="#renderer-渲染器" aria-hidden="true">#</a> Renderer 渲染器</h3><p><strong>Renderer</strong> 根据 <strong>Reconciler</strong> 为虚拟DOM打的标记，同步执行对应的操作。</p><blockquote><p>Renderer 在 commit 阶段工作，遍历 render 阶段生成的 effectList 上的节点，执行真实的DOM操作和一些生命周期</p></blockquote><p>看图。<a href="https://xiaochen1024.com/courseware/60b1b2f6cf10a4003b634718/60b1b328cf10a4003b63471b" target="_blank" rel="noopener noreferrer">来源于--全栈潇晨<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><img src="/fe-study/assets/react_reconciler.3d5f411c.png" alt="react_reconciler"></p><h2 id="fiber" tabindex="-1"><a class="header-anchor" href="#fiber" aria-hidden="true">#</a> Fiber</h2><blockquote><p><a href="https://github.com/acdlite/react-fiber-architecture" target="_blank" rel="noopener noreferrer">Fiber起源<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p></blockquote><h3 id="fiber的含义" tabindex="-1"><a class="header-anchor" href="#fiber的含义" aria-hidden="true">#</a> Fiber的含义</h3><ol><li>对于架构来说，相对于以往的 <code>Stack reconciler</code> ，新的是基于 <code>Fiber节点(FiberNode)</code> 实现的</li><li>作为静态的数据结构，每个 <code>Fiber节点</code> 对应一个 <code>React element</code> ，保存了该组件的类型（函数组件/类组件/原生组件...）、对应的DOM节点等信息。</li><li>作为动态的工作单元来说，每个 <code>Fiber节点</code> 保存了本次更新中该组件改变的状态、要执行的工作（需要被删除/被插入页面中/被更新...）。</li></ol><h3 id="fiber结构" tabindex="-1"><a class="header-anchor" href="#fiber结构" aria-hidden="true">#</a> Fiber结构</h3><ol><li>作为架构 --- Fiber链表树</li><li>作为静态数据结构 --- Fiber节点</li><li>作为动态工作单元 --- Fiber节点中保存了本次更新相关的信息</li></ol><p>FiberNode定义 <a href="https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiber.new.js#L117" target="_blank" rel="noopener noreferrer">FiberNode 源码<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">FiberNode</span><span class="token punctuation">(</span>
  <span class="token parameter">tag<span class="token operator">:</span> WorkTag<span class="token punctuation">,</span>
  pendingProps<span class="token operator">:</span> mixed<span class="token punctuation">,</span>
  key<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token operator">|</span> string<span class="token punctuation">,</span>
  mode<span class="token operator">:</span> TypeOfMode<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Instance</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>tag <span class="token operator">=</span> tag<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>elementType <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>stateNode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token comment">// Fiber</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>return <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// reference to the parent</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>child <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// reference to the first child</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>sibling <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// reference to the first sibling</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>ref <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>pendingProps <span class="token operator">=</span> pendingProps<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>memoizedProps <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>dependencies <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>mode <span class="token operator">=</span> mode<span class="token punctuation">;</span>

  <span class="token comment">// Effects</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>effectTag <span class="token operator">=</span> NoEffect<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>subtreeTag <span class="token operator">=</span> NoSubtreeEffect<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>deletions <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>nextEffect <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>firstEffect <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>lastEffect <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>lanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>childLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>alternate <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h3 id="fiber双缓存" tabindex="-1"><a class="header-anchor" href="#fiber双缓存" aria-hidden="true">#</a> Fiber双缓存</h3><p>双缓存是指存在两颗Fiber树，<code>current Fiber</code> 树描述了当前呈现的dom树，<code>workInProgress Fiber</code> 是正在更新的Fiber树，这两颗Fiber树都是在内存中运行的，在workInProgress Fiber构建完成之后会将它作为current Fiber应用到dom上。</p><p>在 mount 阶段（首次渲染），会根据 jsx 对象，构建 Fiber 对象，形成Fiber树，然后这棵 Fiber 树会作为 current Fiber 应用到真实的DOM上。</p><p>在 update 阶段（状态更新），会根据状态变更后的 jsx 对象和 current Fiber 树做对比， 构建形成新的 <code>workInProgress Fiber</code> （字面意思：正在工作的Fiber树）。<code>workInProgress Fiber</code> 的创建会复用 <code>current Fiber树</code> 对应的节点</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>这个决定是否复用的过程，就是Diff算法。</p></div><p><code>workInProgress Fiber</code> 在 <code>render阶段</code> 完成构建后，会进入到 <code>commit阶段</code> 渲染到页面上。当渲染完成后， <code>workInProgress Fiber</code> 切换为 <code>current Fiber</code></p><p>示例如下。</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> App<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>content<span class="token punctuation">,</span> setContent<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#39;这是内容&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>news<span class="token punctuation">&#39;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">这是标题</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string">&#39;这是更新后的内容&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>content<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;app&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><img src="/fe-study/assets/React双缓存.b221061a.svg" alt="流程图"></p><h3 id="react-fiber-是如何工作的" tabindex="-1"><a class="header-anchor" href="#react-fiber-是如何工作的" aria-hidden="true">#</a> React Fiber 是如何工作的？</h3><p>// TODO: 了解每个阶段调用的方法</p><ol><li>初始渲染 <ol><li>创建一个 fiber 树</li></ol></li><li>更新阶段 <ol><li>渲染阶段 render <ol><li>开始阶段 beginWork</li><li>完善阶段 completeWork</li></ol></li><li>提交阶段 commit phase 分为多个子阶段。在这个阶段中，一些生命周期钩子 componentDidXXX 、hook（ useLayoutEffect 、useEffect） 会执行。 <ol><li>before mutation阶段（执行 DOM 操作前）</li><li>mutation阶段（执行 DOM 操作）</li><li>layout阶段（执行 DOM 操作后）</li></ol></li></ol></li></ol><blockquote><p>更为完善的讲解 <a href="https://www.zhihu.com/question/49496872/answer/2137978516" target="_blank" rel="noopener noreferrer">如何理解 React Fiber 架构？ - 弹铁蛋同学的回答 - 知乎<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p></blockquote><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章" aria-hidden="true">#</a> 参考文章</h2><p><a href="https://react.iamkasong.com/preparation/oldConstructure.html" target="_blank" rel="noopener noreferrer">React15架构<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><a href="https://react.iamkasong.com/preparation/newConstructure.html" target="_blank" rel="noopener noreferrer">新的React架构<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><a href="https://react.iamkasong.com/process/fiber.html" target="_blank" rel="noopener noreferrer">Fiber架构的实现原理<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><a href="https://zh-hans.reactjs.org/docs/codebase-overview.html#reconcilers" target="_blank" rel="noopener noreferrer">reconcilers--官网<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><a href="https://xiaochen1024.com/courseware/60b1b2f6cf10a4003b634718/60b1b328cf10a4003b63471b" target="_blank" rel="noopener noreferrer">react源码架构<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><a href="https://www.zhihu.com/question/49496872/answer/2137978516" target="_blank" rel="noopener noreferrer">如何理解 React Fiber 架构？ - 弹铁蛋同学的回答 - 知乎<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><a href="http://www.ayqy.net/blog/dive-into-react-fiber/" target="_blank" rel="noopener noreferrer">完全理解React Fiber<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><a href="https://segmentfault.com/blog/react-secret" target="_blank" rel="noopener noreferrer">React的秘密<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">9/12/2022, 5:33:14 AM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: zhs25427199@gmail.com">vandvassily</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/fe-study/react/jsx.html" class="nav-link" aria-label="JSX是什么？"><!--[--><!--]--> JSX是什么？ <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/fe-study/assets/app.9bc35547.js" defer></script>
  </body>
</html>
